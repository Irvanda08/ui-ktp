<script>
document.addEventListener('DOMContentLoaded', function() {
    const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImJlbmRvZyIsImlhdCI6MTcxNTkzMjQ1Mn0.GSSjztasOq8ak-kvRkd6YntlDntMLkwtTZPw-yPmdsM';
    const apiUrl = 'https://crud-dot-optimum-library-419103.et.r.appspot.com/data';

    // Function to get ID from path URL
    function getIdFromPath() {
        const pathParts = window.location.pathname.split('/');
        console.log('Path parts:', pathParts); // Log path parts for debugging
        const id = pathParts[pathParts.length - 1];
        console.log('Extracted ID:', id); // Log extracted ID
        return isNaN(id) ? null : id;
    }

    const id = getIdFromPath();
    if (!id) {
        alert('ID tidak ditemukan di URL');
        window.location.href = '/home'; // Redirect to home.php
        return;
    }

    // Populate the form with existing data
    fetch(`${apiUrl}/${id}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
    })
    .then(data => {
        console.log('Data fetched:', data); // Log fetched data for debugging
        document.getElementById('id').value = data.id;
        document.getElementById('nama').value = data.nama;
        document.getElementById('tanggal_lahir').value = data.tanggal_lahir;
        document.getElementById('agama').value = data.agama;
        document.getElementById('status').value = data.status;
        document.getElementById('alamat').value = data.alamat;
    })
    .catch((error) => {
        console.error('Kesalahan:', error);
        alert('Terjadi kesalahan saat memuat data');
        window.location.href = '/home';
    });

    // Handle form submission
    document.getElementById('editForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = {
            nama: document.getElementById('nama').value,
            tanggal_lahir: document.getElementById('tanggal_lahir').value,
            agama: document.getElementById('agama').value,
            status: document.getElementById('status').value,
            alamat: document.getElementById('alamat').value
        };

        fetch(`${apiUrl}/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(formData)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            console.log('Sukses:', data);
            alert('Data berhasil diperbarui');
            window.location.href = '/home';
        })
        .catch((error) => {
            console.error('Kesalahan:', error);
            alert('Terjadi kesalahan saat memperbarui data');
        });
    });
});
</script>
