<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Data</title>
</head>
<body>

<form id="editForm">
    <input type="hidden" id="id">
    <div>
        <label for="nama">Nama:</label>
        <input type="text" id="nama" name="nama">
    </div>
    <div>
        <label for="tanggal_lahir">Tanggal Lahir:</label>
        <input type="date" id="tanggal_lahir" name="tanggal_lahir">
    </div>
    <div>
        <label for="agama">Agama:</label>
        <input type="text" id="agama" name="agama">
    </div>
    <div>
        <label for="status">Status:</label>
        <input type="text" id="status" name="status">
    </div>
    <div>
        <label for="alamat">Alamat:</label>
        <input type="text" id="alamat" name="alamat">
    </div>
    <button type="submit">Update</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImJlbmRvZyIsImlhdCI6MTcxNTkzMjQ1Mn0.GSSjztasOq8ak-kvRkd6YntlDntMLkwtTZPw-yPmdsM';
    const apiUrl = 'https://crud-dot-optimum-library-419103.et.r.appspot.com/data';

    function getIdFromPath() {
        const pathParts = window.location.pathname.split('/');
        console.log('Path parts:', pathParts);
        const id = pathParts[pathParts.length - 1];
        console.log('Extracted ID:', id);
        return isNaN(id) ? null : id;
    }

    const id = getIdFromPath();
    if (!id) {
        alert('ID tidak ditemukan di URL');
        window.location.href = '/home';
        return;
    }

    fetch(`${apiUrl}/${id}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
    })
    .then(data => {
        console.log('Data fetched:', data);
        document.getElementById('id').value = data.id;
        document.getElementById('nama').value = data.nama;
        document.getElementById('tanggal_lahir').value = data.tanggal_lahir;
        document.getElementById('agama').value = data.agama;
        document.getElementById('status').value = data.status;
        document.getElementById('alamat').value = data.alamat;
    })
    .catch((error) => {
        console.error('Kesalahan:', error);
        alert('Terjadi kesalahan saat memuat data');
        window.location.href = '/home';
    });

    document.getElementById('editForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = {
            nama: document.getElementById('nama').value,
            tanggal_lahir: document.getElementById('tanggal_lahir').value,
            agama: document.getElementById('agama').value,
            status: document.getElementById('status').value,
            alamat: document.getElementById('alamat').value
        };

        fetch(`${apiUrl}/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(formData)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            console.log('Sukses:', data);
            alert('Data berhasil diperbarui');
            window.location.href = '/home';
        })
        .catch((error) => {
            console.error('Kesalahan:', error);
            alert('Terjadi kesalahan saat memperbarui data');
        });
    });
});
</script>

</body>
</html>
